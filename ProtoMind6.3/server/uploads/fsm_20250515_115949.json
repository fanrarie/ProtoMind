<IR>
    <!-- 连接请求报文 -->
    <message name="CONNECT">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x10 -->
        <constant type="B" length="1" value="0x10"/>
        <!-- 剩余长度，1 - 4字节，范围0x00 - 0xFF -->
        <variable type="B" length="1:4" value="0x00-0xFF"/>
        <!-- 可变报头 -->
        <!-- 协议名长度，2字节，值固定为0x0004 -->
        <constant type="B" length="2" value="0x0004"/>
        <!-- 协议名，4字节，值固定为MQTT -->
        <constant type="B" length="4" value="MQTT"/>
        <!-- 协议级别，1字节，值固定为0x04 -->
        <constant type="B" length="1" value="0x04"/>
        <!-- 连接标志，1字节，范围0x00 - 0xFF -->
        <variable type="B" length="1" value="0x00-0xFF"/>
        <!-- 保持活动时间，2字节，范围0x0000 - 0xFFFF -->
        <variable type="B" length="2" value="0x0000-0xFFFF"/>
        <!-- 有效载荷 -->
        <!-- 客户端标识符长度，2字节，范围0x0000 - 0xFFFF -->
        <variable type="B" length="2" value="0x0000-0xFFFF"/>
        <!-- 客户端标识符，可变长度 -->
        <variable type="B" length="0:" value="0x00-0xFF"/>
    </message>

    <!-- 连接确认报文 -->
    <message name="CONNACK">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x20 -->
        <constant type="B" length="1" value="0x20"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 连接确认标志，1字节，范围0x00 - 0x01 -->
        <variable type="B" length="1" value="0x00-0x01"/>
        <!-- 连接返回码，1字节，范围0x00 - 0x05 -->
        <variable type="B" length="1" value="0x00-0x05"/>
    </message>

    <!-- 发布报文 -->
    <message name="PUBLISH">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，范围0x30 - 0x3F -->
        <variable type="B" length="1" value="0x30-0x3F"/>
        <!-- 剩余长度，1 - 4字节，范围0x00 - 0xFF -->
        <variable type="B" length="1:4" value="0x00-0xFF"/>
        <!-- 可变报头 -->
        <!-- 主题名长度，2字节，范围0x0000 - 0xFFFF -->
        <variable type="B" length="2" value="0x0000-0xFFFF"/>
        <!-- 主题名，可变长度 -->
        <variable type="B" length="0:" value="0x00-0xFF"/>
        <!-- 报文标识符（可选），2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
        <!-- 有效载荷，可变长度 -->
        <variable type="B" length="0:" value="0x00-0xFF"/>
    </message>

    <!-- 发布确认报文 -->
    <message name="PUBACK">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x40 -->
        <constant type="B" length="1" value="0x40"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
    </message>

    <!-- 发布收到报文 -->
    <message name="PUBREC">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x50 -->
        <constant type="B" length="1" value="0x50"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
    </message>

    <!-- 发布释放报文 -->
    <message name="PUBREL">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x62 -->
        <constant type="B" length="1" value="0x62"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
    </message>

    <!-- 发布完成报文 -->
    <message name="PUBCOMP">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x70 -->
        <constant type="B" length="1" value="0x70"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
    </message>

    <!-- 订阅请求报文 -->
    <message name="SUBSCRIBE">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x82 -->
        <constant type="B" length="1" value="0x82"/>
        <!-- 剩余长度，1 - 4字节，范围0x00 - 0xFF -->
        <variable type="B" length="1:4" value="0x00-0xFF"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
        <!-- 有效载荷 -->
        <!-- 主题过滤器长度，2字节，范围0x0000 - 0xFFFF -->
        <variable type="B" length="2" value="0x0000-0xFFFF"/>
        <!-- 主题过滤器，可变长度 -->
        <variable type="B" length="0:" value="0x00-0xFF"/>
        <!-- 最大QoS，1字节，范围0x00 - 0x02 -->
        <variable type="B" length="1" value="0x00-0x02"/>
    </message>

    <!-- 订阅确认报文 -->
    <message name="SUBACK">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0x90 -->
        <constant type="B" length="1" value="0x90"/>
        <!-- 剩余长度，1 - 4字节，范围0x00 - 0xFF -->
        <variable type="B" length="1:4" value="0x00-0xFF"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
        <!-- 有效载荷 -->
        <!-- 订阅返回码，1字节，范围0x00 - 0x80 -->
        <variable type="B" length="1" value="0x00-0x80"/>
    </message>

    <!-- 取消订阅请求报文 -->
    <message name="UNSUBSCRIBE">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0xA2 -->
        <constant type="B" length="1" value="0xA2"/>
        <!-- 剩余长度，1 - 4字节，范围0x00 - 0xFF -->
        <variable type="B" length="1:4" value="0x00-0xFF"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
        <!-- 有效载荷 -->
        <!-- 主题过滤器长度，2字节，范围0x0000 - 0xFFFF -->
        <variable type="B" length="2" value="0x0000-0xFFFF"/>
        <!-- 主题过滤器，可变长度 -->
        <variable type="B" length="0:" value="0x00-0xFF"/>
    </message>

    <!-- 取消订阅确认报文 -->
    <message name="UNSUBACK">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0xB0 -->
        <constant type="B" length="1" value="0xB0"/>
        <!-- 剩余长度，1字节，值固定为0x02 -->
        <constant type="B" length="1" value="0x02"/>
        <!-- 可变报头 -->
        <!-- 报文标识符，2字节，范围0x0001 - 0xFFFF -->
        <variable type="B" length="2" value="0x0001-0xFFFF"/>
    </message>

    <!-- 心跳请求报文 -->
    <message name="PINGREQ">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0xC0 -->
        <constant type="B" length="1" value="0xC0"/>
        <!-- 剩余长度，1字节，值固定为0x00 -->
        <constant type="B" length="1" value="0x00"/>
    </message>

    <!-- 心跳响应报文 -->
    <message name="PINGRESP">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0xD0 -->
        <constant type="B" length="1" value="0xD0"/>
        <!-- 剩余长度，1字节，值固定为0x00 -->
        <constant type="B" length="1" value="0x00"/>
    </message>

    <!-- 断开连接报文 -->
    <message name="DISCONNECT">
        <!-- 固定报头 -->
        <!-- 报文类型和标志位，1字节，值固定为0xE0 -->
        <constant type="B" length="1" value="0xE0"/>
        <!-- 剩余长度，1字节，值固定为0x00 -->
        <constant type="B" length="1" value="0x00"/>
    </message>

    <!-- MQTT协议状态机 -->
    <statemachine>
        <!-- 初始状态 -->
        <INIT>
            <CONNECT condition="Client sends CONNECT packet"/>
        </INIT>
        <!-- 连接状态 -->
        <CONNECT>
            <CONNACK condition="Server sends CONNACK packet"/>
        </CONNECT>
        <!-- 连接确认状态 -->
        <CONNACK>
            <PUBLISH condition="Client or Server sends PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </CONNACK>
        <!-- 发布状态 -->
        <PUBLISH>
            <PUBACK condition="QoS 1, Server sends PUBACK packet"/>
            <PUBREC condition="QoS 2, Server sends PUBREC packet"/>
        </PUBLISH>
        <!-- 发布确认状态 -->
        <PUBACK>
            <PUBLISH condition="Client or Server sends another PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </PUBACK>
        <!-- 发布收到状态 -->
        <PUBREC>
            <PUBREL condition="Client sends PUBREL packet"/>
        </PUBREC>
        <!-- 发布释放状态 -->
        <PUBREL>
            <PUBCOMP condition="Server sends PUBCOMP packet"/>
        </PUBREL>
        <!-- 发布完成状态 -->
        <PUBCOMP>
            <PUBLISH condition="Client or Server sends another PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </PUBCOMP>
        <!-- 订阅状态 -->
        <SUBSCRIBE>
            <SUBACK condition="Server sends SUBACK packet"/>
        </SUBSCRIBE>
        <!-- 订阅确认状态 -->
        <SUBACK>
            <PUBLISH condition="Client or Server sends PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends another SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </SUBACK>
        <!-- 取消订阅状态 -->
        <UNSUBSCRIBE>
            <UNSUBACK condition="Server sends UNSUBACK packet"/>
        </UNSUBSCRIBE>
        <!-- 取消订阅确认状态 -->
        <UNSUBACK>
            <PUBLISH condition="Client or Server sends PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends another UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </UNSUBACK>
        <!-- 心跳请求状态 -->
        <PINGREQ>
            <PINGRESP condition="Server sends PINGRESP packet"/>
        </PINGREQ>
        <!-- 心跳响应状态 -->
        <PINGRESP>
            <PUBLISH condition="Client or Server sends PUBLISH packet"/>
            <SUBSCRIBE condition="Client sends SUBSCRIBE packet"/>
            <UNSUBSCRIBE condition="Client sends UNSUBSCRIBE packet"/>
            <PINGREQ condition="Client sends another PINGREQ packet"/>
            <DISCONNECT condition="Client or Server sends DISCONNECT packet"/>
        </PINGRESP>
        <!-- 断开连接状态 -->
        <DISCONNECT>
            <INIT condition="New connection attempt"/>
        </DISCONNECT>
    </statemachine>
</IR>